<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="format-detection" content="telephone=no" />

    <title>圈子广场</title>

    <link rel="stylesheet" href="http://jq.flyzz.net/weixin/supply/css/mycircle.css"/>
    <link rel="stylesheet" href="http://jq.flyzz.net/weixin/supply/css/dropload.css"/>
    <link rel="stylesheet" href="css/cir-squ.css" />
    <script type="text/javascript">
        (function () {
            var html = document.querySelector("html");
            var width = html.getBoundingClientRect().width;
            html.style.fontSize = width / 16 + "px";
        })();
        
        var phpdata = {
	    	myMemberId: "593", //我的memberid
            pageId : "12045",
			value:"2"
	    }
        
    </script>
</head>
<body>
	<div class="topbar">

		<div class="tb-item active" data-value="2">
			<a href="http://jq.flyzz.net/circle/circlesquare?value=2 " ><span class="innerspan">推荐圈</span></a>
		</div>
		<div class="tb-item " data-value="3">
			<a href="http://jq.flyzz.net/circle/circlesquare?value=3 "><span class="innerspan">协会圈</span></a>
		</div>
		<div class="tb-item " data-value="4">
			<a href="http://jq.flyzz.net/circle/circlesquare?value=4 "><span class="innerspan">其他圈子</span></a>
		</div>

	</div>
<div class="circle-wrap" style="margin-top: 2.2rem;">
	
    <!--我的圈子-->
    <section class="w-color" id="main">
		<div class="circle-my-list" data-id="302" onclick="jumpcircledetail(this)">
			<a href="javascript:;">
				<div class="circle-my-list-img"><img class="lazy" src="http://jiuquandata.b0.upaiyun.com/Android_1503023383321.jpg" data-original="http://jiuquandata.b0.upaiyun.com/Android_1503023383321.jpg" style="display: inline;"></div>
				<div class="circle-my-list-text">
					<p>一壶酒一壶酒一壶酒一壶酒一壶酒一壶酒一壶酒一壶酒</p>
					<div class="circle-my-member">
						<div class="tie-c"><span class="circle-my-member-tie">主题</span><span>2</span></div><span class="circle-my-member-num">成员</span><span>3</span></div>
				</div>
				<div class="circle-action">
					<span class="squ-btn join"><i class="i-join"></i>加入圈子</span>
				</div>
			</a>
		</div>
		<div class="circle-my-list" data-id="302" onclick="jumpcircledetail(this)">
			<a href="javascript:;">
				<div class="circle-my-list-img"><img class="lazy" src="http://jiuquandata.b0.upaiyun.com/Android_1503023383321.jpg" data-original="http://jiuquandata.b0.upaiyun.com/Android_1503023383321.jpg" style="display: inline;"></div>
				<div class="circle-my-list-text">
					<p>一壶酒</p>
					<div class="circle-my-member">
						<div class="tie-c"><span class="circle-my-member-tie">主题</span><span>2</span></div><span class="circle-my-member-num">成员</span><span>3</span></div>
				</div>
				<div class="circle-action">
					<span class="squ-btn join"><i class="i-verify"></i>审核中</span>
				</div>
			</a>
		</div>
		<div class="circle-my-list" data-id="302" onclick="jumpcircledetail(this)">
			<a href="javascript:;">
				<div class="circle-my-list-img"><img class="lazy" src="http://jiuquandata.b0.upaiyun.com/Android_1503023383321.jpg" data-original="http://jiuquandata.b0.upaiyun.com/Android_1503023383321.jpg" style="display: inline;"></div>
				<div class="circle-my-list-text">
					<p>一壶酒</p>
					<div class="circle-my-member">
						<div class="tie-c"><span class="circle-my-member-tie">主题</span><span>2</span></div><span class="circle-my-member-num">成员</span><span>3</span></div>
				</div>
				<div class="circle-action">
					<span class="joined">已加入</span>
				</div>
			</a>
		</div>
    </section>
</div>

<script src="http://jq.flyzz.net/weixin/supply/js/jquery-1.9.1.min.js" ></script>
<script src="http://jq.flyzz.net/weixin/supply/js/jquery.lazyload.min.js"></script>
<script src="http://jq.flyzz.net/weixin/supply/js/dropload.min.js"></script>
<script src="http://jq.flyzz.net/weixin/supply/js/public.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
//	wxhideMenu(wxconf);
	$(function(){
		// 页码
	    var page = 0;
		//接口地址
		var listUrl = "http://jq.flyzz.net/m/member/circledetails";
		
		
	    $('.circle-wrap').dropload({
	        scrollArea : window,
	        loadDownFn : function(me){
	            page++;
	            // 拼接HTML
	            var result = '';
	            $.ajax({
	                type: 'GET',
	                url: listUrl,
	                data:{
	                	memberId: phpdata.myMemberId,
	                	pageSize: 20,
//	                	first: (phpdata.pageId == phpdata.myMemberId)?page:0,
	                	page: page,
	                	value: phpdata.value
	                },
	                dataType: 'json',
	                success: function(data){
	                	console.log(data);
	                	if(data.code == 0){
	                		if(data.list && data.list.length){
	                			data.list.forEach(function(listitem,index){
	                				result += '<div class="circle-my-list" data-id="'+listitem._id+'"  onclick="jumpcircledetail(this)">';
	                				if(listitem.circlerole == 1){
	                					result += '<img class="owner-icon" src="http://jq.flyzz.net/weixin/supply/images/c-master.png"/>';
	                				}
	                				result += '<a href="javascript:;">';
	                				result += 	'<div class="circle-my-list-img"><img class="lazy" src="http://jq.flyzz.net/weixin/supply/images/placeholder.png" data-original="'+listitem.picUrl+'"></div>'+
									            '<div class="circle-my-list-text">'+
								                    '<p>'+listitem.name+'</p>'+
								                   	'<div class="circle-my-member">'+
								                       	'<div class="tie-c"><span class="circle-my-member-tie">主题</span><span>'+listitem.postCount+'</span></div>'+
								                       	'<span class="circle-my-member-num">成员</span><span>'+listitem.userCount+'</span>'+
								                   	'</div>'+
								                '</div>';
	                				result += '</a>';
	                				result += '</div>';
	                			});
	                			
	                		}else{
	                			//锁定
	                       		me.lock();
		                        // 无数据
		                        me.noData();
		                        if(page == 1){
		                        	$(".dropload-down").hide();
		                        	$("body").append('<div class="nodatadiv"></div>');
		                        }
	                		}
	                	}else{
	                		alert("请求数据失败");
	                	}

	                    setTimeout(function(){
	                        // 插入数据到页面，放到最后面
	                        $('#main').append(result);
	                        $("img.lazy").lazyload();
	                        // 每次数据插入，必须重置
	                        me.resetload();
	                    },0);
	                },
	                error: function(xhr, type){
//	                    $.showtoa('网络错误!');
	                    // 即使加载出错，也得重置
	                    me.resetload();
	                }
	            });
	        }
	    });
	    
	    
	    

	});
	function jumpcircledetail(th){
		window.location.href = "http://jq.flyzz.net/niche/wxcircleindex" + "?circleId=" + $(th).attr("data-id");
	}
</script>
</body>
</html>